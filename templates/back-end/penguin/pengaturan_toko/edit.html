{include file="$include_tpl/includes/head.html"}
<!--sidebar-->
{include file="$include_tpl/includes/sidebar.html"}
<!--/sidebar-->
<!--Page Container-->
<section class="main-container">	
    <!--Page Header-->
    <div class="header">
        <div class="header-content">
            <div class="page-title">
                <i class="icon-table position-left"></i> {$title}
            </div>
            <ul class="breadcrumb">
                <li><a href="{$adminweburl}">Beranda</a></li>
                <li><a href="{$adminweburl}/pengaturan_toko/">{$title}</a></li>
                <li class="active">{$sub_title}</li>
            </ul>					
        </div>
    </div>		
    <!--/Page Header-->

    <!--Page Content-->
    <div id="wrapper" class="container-fluid page-content">				
        <div class="panel panel-flat" style="margin: 5px;">
            <div class="form-group panel-body no-padding-bottom">
                
                <div class="form-group">
                    <ul id="myTab" class="nav nav-tabs">                                
                        <li class="active">
                            <a href="#profiltoko" data-toggle="tab"><b>PROFIL TOKO</b></a>
                        </li>                                 
                        <li>
                            <a href="#hubungikami" data-toggle="tab"><b>HUBUNGI KAMI</b></a>
                        </li>                                
                        <li>
                            <a href="#sosialmedia" data-toggle="tab"><b>SOSIAL MEDIA</b></a>
                        </li>
                    </ul>
                </div>

                <div id="alert_success" class="form-group" style="display: none;">                         
                    <div class="alert alert-info">&nbsp;</div>
                </div>

                <div id="alert_error" class="form-group" style="display: none;">                         
                    <div class="alert alert-danger">&nbsp;</div>
                </div>

                <div class="form-group tab-content">
                    <div class="tab-pane fade active in" id="profiltoko">

                        <div class="form-group">
                            <label for="judul">Judul Webite:</label>
                            <input type="text" value="{$data[0].judul}" class="form-control" name="judul" placeholder="" />
                        </div>

                        <div class="form-group">
                            <label for="tagline">Tag Line:</label>
                            <input type="text" value="{$data[0].tagline}" class="form-control" name="tagline" placeholder="" />
                        </div>

                        <div class="form-group">
                            <label for="alamat">Alamat Toko:</label>
                            <textarea class="form-control" style="height: 50px;" name="alamat">{$data[0].alamat}</textarea>
                        </div>

                        <div class="form-group">
                            <label for="propinsi">Propinsi:</label>
                            <select id="propinsi" name="propinsi" class="form-control">
                                {foreach $listpropinsi as $entry}
                                    <option value="{$entry.province_id}"{if $entry.province_id eq $data[0].propinsi} selected="selected"{/if}>{$entry.province}</option>
                                {/foreach}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="kota">Kota:</label>
                            <select id="kota" name="kota" class="form-control"></select>
                        </div>

                        <div class="form-group">
                            <label for="kode_pos">Kode Pos:</label>
                            <input type="text" value="{$data[0].kode_pos}" class="form-control" name="kode_pos" />
                        </div>

                        <div class="form-group">
                            <label for="latitude">Latitude:</label>
                            <input type="text" value="{$data[0].latitude}" class="form-control" name="latitude" />
                        </div>

                        <div class="form-group">
                            <label for="longitude">Longitude:</label>
                            <input type="text" value="{$data[0].longitude}" class="form-control" name="longitude" />
                        </div>

                        <div class="form-group">
                            <label for="logo">Logo:</label>                        
                            <style type="text/css">
                                .preview-logo {
                                    border:1px solid #a6bac4;
                                    width: 180px;
                                    height: 180px;
                                    cursor: move;
                                }
                                .post-img-logo {
                                    width: 180px;
                                    height: 180px;
                                }
                            </style>
                            <div class="image-editor-logo post-img-logo">
                                <input id="fileupload_logo" type="file" name="fileupload_logo" style="display:none;" class="cropit-image-input" />
                                <div class="cropit-image-preview preview-logo"></div>
                            </div>
                            <label>Ukuran 180 X 180 px</label><br />   
                            <div id="upload_logo" class="btn btn-primary">Upload</div>
                        </div>

                        <div class="form-group">&nbsp;</div>

                        <div class="form-group">
                            <div id="i_loading_profiltoko" class="G-btn-animation" style="display: none;"><img src="{$tpl_dir}/assets/img/loading.gif" /></div>                  
                            {if 'E'|in_array:$array_akses}<div id="btn_simpan_profiltoko" class="btn btn-primary">Update</div>{/if}
                        </div>
                    </div>

                    <div class="tab-pane fade" id="hubungikami">

                        <div class="form-group">&nbsp;</div>

                        <div class="form-group">
                            <label for="jam_kerja">Jam Kerja:</label>
                            <input type="text" value="{$data[0].jam_kerja}" class="form-control" name="jam_kerja" placeholder="" />
                        </div>
                        
                        <div class="form-group">                        
                            <label for="no_hp">No. HP:</label>
                            <div id="detail_no_hp" class="table-responsive">
                                <table id="tblNo_hp" width="100%">
                                    <tbody id="no_hp"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="form-group">                        
                            <label for="wa">WA:</label>
                            <div id="detail_wa" class="table-responsive">
                                <table id="tblWa" width="100%">
                                    <tbody id="wa"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="form-group">                        
                            <label for="sms">SMS:</label>
                            <div id="detail_sms" class="table-responsive">
                                <table id="tblSms" width="100%">
                                    <tbody id="sms"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="text" value="{$data[0].email}" class="form-control" name="email" placeholder="" />
                        </div>

                        <div class="form-group">                        
                            <label for="line">Line:</label>
                            <div id="detail_line" class="table-responsive">
                                <table id="tblLine" width="100%">
                                    <tbody id="line"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="form-group">                        
                            <label for="bbm">BBM:</label>
                            <div id="detail_bbm" class="table-responsive">
                                <table id="tblBbm" width="100%">
                                    <tbody id="bbm"></tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="form-group">&nbsp;</div>

                        <div class="form-group">
                            <div id="i_loading_hubungikami" class="G-btn-animation" style="display: none;"><img src="{$tpl_dir}/assets/img/loading.gif" /></div>                  
                            {if 'E'|in_array:$array_akses}<div id="btn_simpan_hubungikami" class="btn btn-primary">Update</div>{/if}
                        </div>
                    </div>

                    <div class="tab-pane fade" id="sosialmedia">

                        <div class="form-group">&nbsp;</div>

                        <div class="form-group">
                            <label for="facebook">Facebook:</label>
                            <input type="text" value="{$data[0].facebook}" class="form-control" name="facebook" placeholder="" />
                        </div>
                        
                        <div class="form-group">
                            <label for="instagram">Instagram:</label>
                            <input type="text" value="{$data[0].instagram}" class="form-control" name="instagram" placeholder="" />
                        </div>
                        
                        <div class="form-group">
                            <label for="twitter">Twitter:</label>
                            <input type="text" value="{$data[0].twitter}" class="form-control" name="twitter" placeholder="" />
                        </div>
                        
                        <div class="form-group">&nbsp;</div>

                        <div class="form-group">
                            <div id="i_loading_sosialmedia" class="G-btn-animation" style="display: none;"><img src="{$tpl_dir}/assets/img/loading.gif" /></div>                  
                            {if 'E'|in_array:$array_akses}<div id="btn_simpan_sosialmedia" class="btn btn-primary">Update</div>{/if}
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!--/Page Content-->

    <!--Footer -->
    {include file="$include_tpl/includes/footer.html"}
    <!--/Footer-->
		
</section>
<!--/Page Container-->

<!-- Global scripts -->
<script src="{$tpl_dir}/js/jquery.js"></script>	
<script src="{$tpl_dir}/js/bootstrap.js"></script>
<script src="{$tpl_dir}/js/jquery.ui.js"></script>
<script src="{$tpl_dir}/js/nav.accordion.js"></script>	
<script src="{$tpl_dir}/js/hammerjs.js"></script>
<script src="{$tpl_dir}/js/jquery.hammer.js"></script>
<script src="{$tpl_dir}/js/scrollup.js"></script>	
<script src="{$tpl_dir}/js/jquery.slimscroll.js"></script>	
<script src="{$tpl_dir}/js/smart-resize.js"></script>
<script src="{$tpl_dir}/js/blockui.min.js"></script>		
<script src="{$tpl_dir}/js/wow.min.js"></script>					
<script src="{$tpl_dir}/js/fancybox.min.js"></script>
<script src="{$tpl_dir}/js/venobox.js"></script>
<script src="{$tpl_dir}/js/forms/uniform.min.js"></script>
<script src="{$tpl_dir}/js/forms/switchery.js"></script>
<script src="{$tpl_dir}/js/forms/select2.min.js"></script>	
<script src="{$tpl_dir}/js/core.js"></script>
<!-- /global scripts -->	

<script type="text/javascript" src="{$tpl_dir}/assets/js/jquery.cropit.js"></script>  
<script src="{$tpl_dir}/assets/bootstrap-fileinput/js/fileinput.js"></script>

<script type="text/javascript">        
        $(function () {           

            var setLoading = function(isLoading, tab) {
                if(isLoading) {
                    $('#i_loading_'+tab).show();
                    $('#btn_simpan_'+tab).hide();
                } else {
                    $('#i_loading_'+tab).hide();
                    $('#btn_simpan_'+tab).show();                    
                }
            };
            
            var setMessage = function(type, message) {
                $('#alert_'+type+' .alert').text(message);
                $('#alert_'+type).show('slow');
                setTimeout(function() {
                    $('#alert_'+type).hide('slow');
                }, 5000);
                $("body, html").animate({ 
                    scrollTop: $('#wrapper').offset().top 
                }, 600);
            };
            
            $('#upload_logo').click(function(){
                $('#fileupload_logo').trigger('click'); 
                return false;
            });
            
            $('.image-editor-logo').cropit({
              smallImage: 'stretch'{if $data[0].logo neq ''},
              imageState: {
                src: '{$homeurl}/uploads/umum/{$data[0].logo}',
              }{/if}
            });

            {assign var="no" value=1}
            {foreach $listno_hp as $entry}
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="{$entry.no_hp}" name="no_hp" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no gt 1}<div class="btn btn-danger hapus_no_hp">Hapus</div>{/if}</div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no eq 1}<div id="btn_tambah_no_hp" class="btn btn-primary">Tambah</div>{/if}</div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#no_hp" );
                {assign var="no" value=$no+1}
            {/foreach}
            
            $( document ).on( 'click', '.hapus_no_hp', function() {
                var element = $(this).closest('tr');
                element.remove();
            });
            
            $('#btn_tambah_no_hp').click(function() {
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="" name="no_hp" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"><div class="btn btn-danger hapus_no_hp">Hapus</div></div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"></div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#no_hp" );
            });

            {assign var="no" value=1}
            {foreach $listwa as $entry}
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="{$entry.wa}" name="wa" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no gt 1}<div class="btn btn-danger hapus_wa">Hapus</div>{/if}</div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no eq 1}<div id="btn_tambah_wa" class="btn btn-primary">Tambah</div>{/if}</div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#wa" );
                {assign var="no" value=$no+1}
            {/foreach}

            $( document ).on( 'click', '.hapus_wa', function() {
                var element = $(this).closest('tr');
                element.remove();
            });

            $('#btn_tambah_wa').click(function() {
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="" name="wa" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"><div class="btn btn-danger hapus_wa">Hapus</div></div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"></div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#wa" );
            });

            {assign var="no" value=1}
            {foreach $listsms as $entry}
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="{$entry.sms}" name="sms" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no gt 1}<div class="btn btn-danger hapus_sms">Hapus</div>{/if}</div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no eq 1}<div id="btn_tambah_sms" class="btn btn-primary">Tambah</div>{/if}</div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#sms" );
                {assign var="no" value=$no+1}
            {/foreach}

            $( document ).on( 'click', '.hapus_sms', function() {
                var element = $(this).closest('tr');
                element.remove();
            });

            $('#btn_tambah_sms').click(function() {
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="" name="sms" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"><div class="btn btn-danger hapus_sms">Hapus</div></div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"></div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#sms" );
            });
            
            {assign var="no" value=1}
            {foreach $listbbm as $entry}
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="{$entry.bbm}" name="bbm" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no gt 1}<div class="btn btn-danger hapus_bbm">Hapus</div>{/if}</div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no eq 1}<div id="btn_tambah_bbm" class="btn btn-primary">Tambah</div>{/if}</div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#bbm" );
                {assign var="no" value=$no+1}
            {/foreach}

            $( document ).on( 'click', '.hapus_bbm', function() {
                var element = $(this).closest('tr');
                element.remove();
            });

            $('#btn_tambah_bbm').click(function() {
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="" name="bbm" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"><div class="btn btn-danger hapus_bbm">Hapus</div></div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"></div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#bbm" );
            });

            {assign var="no" value=1}
            {foreach $listline as $entry}
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="{$entry.line}" name="line" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no gt 1}<div class="btn btn-danger hapus_line">Hapus</div>{/if}</div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;">{if $no eq 1}<div id="btn_tambah_line" class="btn btn-primary">Tambah</div>{/if}</div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#line" );
                {assign var="no" value=$no+1}
            {/foreach}

            $( document ).on( 'click', '.hapus_line', function() {
                var element = $(this).closest('tr');
                element.remove();
            });

            $('#btn_tambah_line').click(function() {
                var record = 
                    '<tr>' +
                        '<td style="padding: 5px;" width="100%"><input type="text" value="" name="line" class="form-control" placeholder="" /></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"><div class="btn btn-danger hapus_line">Hapus</div></div></td>' +
                        '<td style="padding: 5px;"><div style="text-align: center;  white-space: nowrap;"></div></td>' +
                    '</tr>';
                $( record ).insertBefore( "#line" );
            });

            $('#propinsi').on('change', function (e) {
                loadKota(this.value, 0);
            });

            var loadKota = function(propinsi, kota) {
                $("#kota").empty();
                //$('<option value="0">-- Pilih Kota --</option>').appendTo('#kota');
                $.ajax({
                    type: 'POST',
                    url: '{$homeurl}/store/getKota.php',
                    data: { 'propinsi': propinsi },
                    dataType: 'json',
                    success: function(data) {
                        var store = data['topics'];
                        var data = ''; //'<option value="0">-- Pilih Kota --</option>';
                        for(var key in store) {
                            data+='<option value="'+store[key]['city_id']+'"'+(store[key]['city_id']==kota?' selected="selected"':'')+'>'+store[key]['city_name']+'</option>';
                        }
                        $("#kota").empty();
                        $(data).appendTo('#kota');
                    }
                });    
            };

            {if $data[0].propinsi gt 0}loadKota('{$data[0].propinsi}', '{$data[0].kota}');{/if}
            
            $('#btn_simpan_profiltoko').click(function() {
                var data = new FormData();
                data.append('judul', $('[name=judul]').val());
                data.append('tagline', $('[name=tagline]').val());
                data.append('address', $('[name=alamat]').val());
                data.append('propinsi', $('[name=propinsi]').val());
                data.append('nama_propinsi', $("#propinsi option[value='"+$('[name=propinsi]').val()+"']").text());
                data.append('kota', $('[name=kota]').val());
                data.append('nama_kota', $("#kota option[value='"+$('[name=kota]').val()+"']").text());
                data.append('kode_pos', $('[name=kode_pos]').val());                
                data.append('latitude', $('[name=latitude]').val());                
                data.append('longitude', $('[name=longitude]').val());
                var imageDataLogo = $('.image-editor-logo').cropit('export');
                data.append('filename_logo', imageDataLogo==undefined?'':imageDataLogo);
                
                setLoading(true, 'profiltoko');
                $.ajax({
                    type: 'POST',
                    url: 'updateProfiltoko.php',
                    data: data,
                    cache: false,
                    dataType: 'json',
                    processData: false, // Don't process the files
                    contentType: false, // Set content type to false as jQuery will tell the server its a query string request
                    success: function(data) {
                        setLoading(false, 'profiltoko');
                        if(data['success']) {
                            setMessage('success', data['message']);  
                        } else {
                            setMessage('error', data['message']);                        
                        }
                    }, 
                    error: function() {
                        setLoading(false, 'profiltoko');
                        setMessage('error', 'Kesalahan server. Mohon diulang kembali!');
                    }
                }); 
            });

            $('#btn_simpan_hubungikami').click(function() {            
                var no_hp = '';
                $("#tblNo_hp tr").each(function() {
                    var data = $(this).find('[name=no_hp]').val();
                    no_hp+=(no_hp==''?'':'\t')+data;
                });

                var wa = '';
                $("#tblWa tr").each(function() {
                    var data = $(this).find('[name=wa]').val();
                    wa+=(wa==''?'':'\t')+data;
                });
                
                var sms = '';
                $("#tblSms tr").each(function() {
                    var data = $(this).find('[name=sms]').val();
                    sms+=(sms==''?'':'\t')+data;
                });
                
                var line = '';
                $("#tblLine tr").each(function() {
                    var data = $(this).find('[name=line]').val();
                    line+=(line==''?'':'\t')+data;
                });

                var bbm = '';
                $("#tblBbm tr").each(function() {
                    var data = $(this).find('[name=bbm]').val();
                    bbm+=(bbm==''?'':'\t')+data;
                });
                
                var data = new FormData();
                data.append('jam_kerja', $('[name=jam_kerja]').val());                
                data.append('no_hp', no_hp);
                data.append('wa', wa);
                data.append('sms', sms);                
                data.append('email', $('[name=email]').val());                
                data.append('bbm', bbm);                
                data.append('line', line);
                
                setLoading(true, 'hubungikami');
                $.ajax({
                    type: 'POST',
                    url: 'updateHubungikami.php',
                    data: data,
                    cache: false,
                    dataType: 'json',
                    processData: false, // Don't process the files
                    contentType: false, // Set content type to false as jQuery will tell the server its a query string request
                    success: function(data) {
                        setLoading(false, 'hubungikami');
                        if(data['success']) {
                            setMessage('success', data['message']);  
                        } else {
                            setMessage('error', data['message']);                        
                        }
                    }, 
                    error: function() {
                        setLoading(false, 'hubungikami');
                        setMessage('error', 'Kesalahan server. Mohon diulang kembali!');
                    }
                }); 
            });

            $('#btn_simpan_sosialmedia').click(function() {
                var data = new FormData();
                data.append('facebook', $('[name=facebook]').val());
                data.append('instagram', $('[name=instagram]').val());
                data.append('twitter', $('[name=twitter]').val());
                
                setLoading(true, 'sosialmedia');
                $.ajax({
                    type: 'POST',
                    url: 'updateSosialmedia.php',
                    data: data,
                    cache: false,
                    dataType: 'json',
                    processData: false, // Don't process the files
                    contentType: false, // Set content type to false as jQuery will tell the server its a query string request
                    success: function(data) {
                        setLoading(false, 'sosialmedia');
                        if(data['success']) {
                            setMessage('success', data['message']);  
                        } else {
                            setMessage('error', data['message']);                        
                        }
                    }, 
                    error: function() {
                        setLoading(false, 'sosialmedia');
                        setMessage('error', 'Kesalahan server. Mohon diulang kembali!');
                    }
                }); 
            });
        });
        
    </script>
</body>{include file="$include_tpl/includes/footer_js.html"}
</html>